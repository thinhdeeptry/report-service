# Report Service API

API service để quản lý báo cáo trong hệ thống Edu Forge.

## Cài đặt

```bash
# Cài đặt dependencies
npm install

# Chạy ở chế độ development
npm run start:dev

# Build và chạy ở chế độ production
npm run build
npm run start:prod
```

## Sử dụng Docker

```bash
# Build Docker image
npm run docker:build

# Chạy container
npm run docker:run

# Hoặc sử dụng docker-compose
npm run docker:compose
```

## API Endpoints

### Lấy danh sách báo cáo
```
GET /reports
```

### Lấy chi tiết báo cáo
```
GET /reports/:id
```

### Tạo báo cáo mới
```
POST /reports
Body: {
  "title": "Báo cáo tháng 5/2025",
  "date": "2025-05-13T00:00:00.000Z",
  "data": {
    // Dữ liệu báo cáo
  }
}
```

### Cập nhật báo cáo
```
PUT /reports/:id
Body: {
  "title": "Báo cáo tháng 5/2025 (Cập nhật)",
  // Các trường khác cần cập nhật
}
```

### Xóa báo cáo
```
DELETE /reports/:id
```

### Cập nhật phân tích AI cho báo cáo
```
POST /reports/:id/analysis
Body: {
  "chartData": {
    // Dữ liệu biểu đồ
  },
  "predictions": {
    // Dữ liệu dự đoán
  },
  "recommendations": [
    // Danh sách đề xuất
  ]
}
```

### Tạo báo cáo tự động
```
POST /reports/generate
Body: {
  "userId": "user-id" // Không bắt buộc, mặc định là "system"
}
```

## Postman Collection

Dự án này bao gồm một Postman Collection để dễ dàng kiểm tra API. Để sử dụng:

1. Mở Postman
2. Nhấp vào "Import" ở góc trên bên trái
3. Chọn file `Report Service API.postman_collection.json`
4. Nhấp vào "Import" để hoàn tất

Để cấu hình môi trường:

1. Nhấp vào "Environments" ở sidebar bên trái
2. Nhấp vào "Import" và chọn file `Report Service Environments.postman_environment.json`
3. Chọn môi trường "Report Service - Development" từ dropdown ở góc trên bên phải

## Cấu trúc dữ liệu

### Report Schema
```typescript
{
  title: string;           // Tiêu đề báo cáo
  date: Date;              // Ngày tạo báo cáo
  data: any;               // Dữ liệu báo cáo
  aiAnalysis?: any;        // Phân tích AI (nếu có)
  isAutoGenerated: boolean; // Báo cáo được tạo tự động hay không
  generatedBy: string;     // ID của người tạo báo cáo
  status: string;          // Trạng thái báo cáo (PENDING, COMPLETED, FAILED)
}
```

## Cron Jobs

Service này bao gồm các cron job để tự động tạo báo cáo định kỳ:

- Báo cáo hàng ngày: Chạy vào lúc 00:01 mỗi ngày
- Báo cáo hàng tuần: Chạy vào lúc 00:05 mỗi Chủ nhật
- Báo cáo hàng tháng: Chạy vào lúc 00:10 ngày đầu tiên của mỗi tháng

## Tích hợp với Frontend

Để tích hợp với frontend, bạn cần cập nhật file `src/stores/useReportStore.ts` để sử dụng API thay vì lưu trữ trong localStorage.
